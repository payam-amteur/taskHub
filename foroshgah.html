<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Document</title>
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
            <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>

            <style>
            body {
                        background-color: rgb(106, 106, 153);
                        font-family: Vazirmatn, sans-serif;
            }
            .card{
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                        border: none;
                        border-radius: 15px;
                        overflow: hidden;
                        transition: transform 0.4s ease;
            }
            .card:hover{
                        transform: scale(1.06);
            }
            </style>
</head>
<body>
            <div class="container">
                        <h2 class="text-center mt-5 mb-5 fw-bolder">فروشگاه </h2>
                        <div class="row">


                                    <!--product-->
                                    <div class="col-md-8">
                                                <h3 class="mb-4 fw-bolder">محصولات</h3>
                                                <div id="productList" class="row g-4"></div>
                                    </div>


                                    <!--cart-->
                                    <div class="col-md-4">
                                                <h3 class="mb-4 fw-bolder">سبد خرید</h3>
                                                <div class="card p-3">
                                                            <ul id="cartList" class="list-group list-group-flush mb-3">

                                                            </ul>
                                                            <div class="d-flex justify-content-center align-items-center">
                                                                        <h5>مجموع:</h5>
                                                                        <h5 id="totalPrice">0تومان</h5>
                                                            </div>
                                                            <button class="btn btn-success w-100 mt-3">پرداخت</button>
                                                </div>
                                    </div>
                        </div>
            </div>


            <script>
                         const products = [
                                    {
                                                id: 1,
                                                name: 'کفش ملی',
                                                price: 5000000,
                                                Image: 
                                                "https://th.bing.com/th/id/OIP.8B8YRPIJ8TI6oYN3LpCNGAHaIT?w=162&h=181&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3"
                                    },
                                    {
                                                id: 2,
                                                name: 'کفش طبی',
                                                price: 3500000,
                                                Image: 
                                                "https://tse3.mm.bing.net/th/id/OIP.e7tbMF0Izq1mk-eqmZn3jQHaHa?rs=1&pid=ImgDetMain&o=7&rm=3"
                                    },
                                    {
                                                id: 3,
                                                name: 'کفش ورزشی',
                                                price: 9000000,
                                                Image: 
                                                "https://th.bing.com/th/id/OIP.VHwYwBf_pi7aSY9crfZMywHaEI?w=316&h=180&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3"
                                    }
                        ];

                        let cart = JSON.parse(localStorage.getItem("cart")) || [];

                        const updateLocalStorage = () => {
                                    localStorage.setItem("cart", JSON.stringify(cart));
                        }




                        const addToCart = (productId) => {
                                    const product = products.find((p) => p.id === productId);
                                    const cartItem = cart.find((item) => item.id === productId);

                                    if(cartItem){
                                                cartItem.quantity++;
                                    }else{
                                                cart.push({...product,quantity: 1});
                                    }

                                    updateLocalStorage();
                                    renderCart();
                        } 

                        const removeFromCart = (productId) => {
                                    cart = cart.filter((item) => item.id !== productId);
                                    updateLocalStorage();
                                    renderCart();
                        }

                        const updateQuantity = (productId,quantity) => {
                                    const cartItem = cart.find((item) => item.id === productId);

                                    if(cartItem){
                                                cartItem.quantity = quantity > 0 ? quantity : 0;
                                    if(cartItem.quantity === 0){
                                                  removeFromCart(productId);
                                    }
                                    updateLocalStorage();
                                    renderCart();
                                    }
                        }

                        const calcTotal = () => cart.reduce((total, item) => total + item.price * item.quantity, 0);


                        renderCart = () => {
                                    const cartListElement = document.getElementById("cartList");
                                    cartListElement.innerHTML = "";
                                    cart.forEach(item => {
                                            const li = document.createElement("li");
                                            li.className = "list-group-item d-flex flex-column align-items-start mb-3";
                                            li.innerHTML = `
                                            <div class="d-flex justify-content-between w-100">
                                                <strong>${item.name}</strong>
                                                <span>${item.price.toLocaleString()} تومان</span>
                                                </div>
                                                <div class="d-flex justify-content-between w-100 mt-2">
                                                            <div class="d-flex justify-content-between w-100 mt-2">
                                                                        <input type="number" class="form-control form-control-sm me-2" style="width: 60px" value="${item.quantity}"/>
                                                                        <i class="fa fa-trash remove-btn text-danger me-2" data-id=${
                                                                        item.id
                                                                        } style="cursor:pointer"></i>
                                                            </div>
                                                </div>                        
                                            `   
                                            li.querySelector('.remove-btn').addEventListener("click",() => {
                                                removeFromCart(item.id)
                                            })
                                             
                                            li.querySelector('input').addEventListener("change",(e) => {
                                                const quantity = parseInt(e.target.value,10);
                                                updateQuantity(item.id, quantity);
                                            });
                                            cartListElement.appendChild(li);
                                    })

                                    const totalPriceElement = document.getElementById("totalPrice");
                                    const total = calcTotal();
                                    totalPriceElement.textContent = total.toLocaleString() + " تومان";
                        }
                        const renderProducts = () => {
                                    const productListElement = document.getElementById("productList");
                                    productListElement.innerHTML = "";
                                    products.forEach(product => {
                                                const card = document.createElement('div');
                                                card.className = "col-md-4";
                                                card.innerHTML = `
                                                <div class="card">
                                                            <img src="${product.Image}" class="card-img-top"/>
                                                            <div class="card-body">
                                                                        <h5 class="card-title">${product.name}</h5>
                                                                        <p class="card-text">${product.price.toLocaleString()}</p>
                                                                        <button class="btn btn-primary btn-sm" data-id=${product.id}>افزودن به سبد خرید</button>
                                                            </div>
                                                </div>
                                                `
                                                card.querySelector("button").addEventListener('click',() => addToCart(product.id));
                                                productListElement.appendChild(card);
                                    });
                                    
                        }
                        renderProducts();
                        renderCart();
            </script>
</body>
</html>